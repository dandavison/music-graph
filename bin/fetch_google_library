#!/usr/bin/env python
import json

from music_graph.apis.google import fetch_all_tracks
from music_graph.db.sqla import execute
from music_graph.db.sqla import get_table


google_tracks_t = get_table('google_tracks')
tracks = fetch_all_tracks()

values = []
for track in tracks:
    try:
        [artist_id] = track['artistId']
    except (KeyError, ValueError):
        continue
    values.append({
        'artist_id': artist_id,
        'json': json.dumps(track)
    })

execute(google_tracks_t.insert(), values)
